<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Carte - Soleil Englouti</title>
<style>
body {
    background: #111;
    color: white;
    font-family: Arial;
    text-align: center;
}

#map-container {
    width: 95%;
    margin: auto;
}

svg {
    width: 100%;
    height: auto;
}

.tooltip {
    position: absolute;
    background: black;
    padding: 6px;
    border-radius: 4px;
    font-size: 14px;
    pointer-events: none;
    display: none;
}
button {
    margin: 15px;
    padding: 8px 15px;
    cursor: pointer;
}
</style>
</head>
<body>

<h2>Carte Stratégique — La Légion du Soleil Englouti</h2>
<button onclick="loadData()">Actualiser</button>
<div id="map-container"></div>
<div class="tooltip" id="tooltip"></div>

<script>

const NOTION_TOKEN = "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";
const DATABASE_ID = "3047e1c28aff80ffa960ca981013e394";

async function loadData() {

    const response = await fetch("https://carte-soleil-englouti.vercel.app/", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${NOTION_TOKEN}`,
            "Notion-Version": "2022-06-28",
            "Content-Type": "application/json"
        },
        body: JSON.stringify({})
    });

    const data = await response.json();
    const pages = data.results;

    fetch("map.svg")
        .then(res => res.text())
        .then(svgText => {

            document.getElementById("map-container").innerHTML = svgText;

            pages.forEach(page => {

                const hexId = page.properties["ID Hex"].rich_text[0]?.plain_text;
                const statut = page.properties["Statut"]?.select?.name || "Neutre";
                const nom = page.properties["Nom"].title[0]?.plain_text || "";
                const faction = page.properties["Faction"]?.select?.name || "";

                const hex = document.getElementById(hexId);

                if (hex) {

                    let color = "#666";

                    if (statut === "Conquis") color = "#8b0000";
                    if (statut === "Ennemi") color = "#000";
                    if (statut === "Neutre") color = "#666";

                    hex.style.fill = color;

                    hex.addEventListener("mouseover", (e) => {
                        const tooltip = document.getElementById("tooltip");
                        tooltip.innerHTML = `<strong>${nom}</strong><br>Faction: ${faction}<br>Statut: ${statut}`;
                        tooltip.style.display = "block";
                        tooltip.style.left = e.pageX + 10 + "px";
                        tooltip.style.top = e.pageY + 10 + "px";
                    });

                    hex.addEventListener("mouseout", () => {
                        document.getElementById("tooltip").style.display = "none";
                    });
                }
            });
        });
}

loadData();

</script>
</body>
</html>
